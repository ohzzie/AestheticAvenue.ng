{% extends "base.html" %}
{% block content %}
<h1>{{ p and ('Edit: ' ~ p['title']) or 'New product' }}</h1>
<form method="post">
  {{ csrf_token()|safe }}
  <div class="form-row">
    <label for="title">Title</label>
    <input id="title" name="title" value="{{ p and p['title'] }}">
  </div>
  <div class="form-row">
    <label for="price">Price (e.g. 29.99)</label>
    <input id="price" name="price" placeholder="e.g. 15000 or 15,000.00" value="{{ p and (p['price_cents']/100) }}">
  </div>
  <div class="form-row">
    <label for="image_urls">Image URL(s) (comma-separated)</label>
    <textarea id="image_urls" name="image_urls" rows="3" placeholder="Paste one or more direct image links, separated by commas">{{ p and p['image_urls'] }}</textarea>
  </div>
  <div class="form-row">
    <label for="tags">Tags (comma-separated, e.g., new,best,tumblers,caps,bags,addons,aesthetic)</label>
    <input id="tags" name="tags" value="{{ p and p['tags'] }}">
  </div>
  <div class="form-grid">
    <div class="form-row">
      <label for="stock_qty">Stock quantity</label>
      <input id="stock_qty" name="stock_qty" type="number" min="0" value="{{ p and p['stock_qty'] or 0 }}">
    </div>
    <div class="form-row" style="display:flex;align-items:center;gap:.5rem;">
      <input id="track_inventory" name="track_inventory" type="checkbox" {% if p and p['track_inventory'] %}checked{% endif %}>
      <label for="track_inventory">Track inventory for this product</label>
    </div>
  </div>
  <div class="form-row">
    <label for="description">Description (rich text allowed)</label>
    <textarea id="description" name="description" rows="8">{{ p and p['description'] }}</textarea>
  </div>
  <button class="btn" type="submit">{{ p and 'Update' or 'Create' }}</button>
  <a class="btn btn-outline" href="{{ url_for('admin_products') }}">Cancel</a>
</form>

{% if p %}
<hr>
<h2>Variants</h2>
<form method="post" action="{{ url_for('admin_variant_new', pid=p['id']) }}">
  {{ csrf_token()|safe }}
  <div class="form-grid">
    <div class="form-row">
      <label for="v_name">Color name</label>
      <input id="v_name" name="name" placeholder="e.g., Red" required>
    </div>
    <div class="form-row">
      <label for="v_price">Variant price (optional)</label>
      <input id="v_price" name="price" placeholder="leave blank to use product price">
    </div>
    <div class="form-row">
      <label for="v_stock">Stock quantity</label>
      <input id="v_stock" name="stock_qty" type="number" min="0" value="0">
    </div>
    <div class="form-row" style="display:flex;align-items:center;gap:.5rem;">
      <input id="v_track" name="track_inventory" type="checkbox">
      <label for="v_track">Track inventory</label>
    </div>
  </div>
  <div class="form-row">
    <label for="v_images">Image URL(s) (optional, comma-separated)</label>
    <input id="v_images" name="image_urls" placeholder="https://...">
  </div>
  <button class="btn" type="submit">Add variant</button>
</form>

<table>
  <thead><tr><th>Color</th><th>Price</th><th>Stock</th><th></th></tr></thead>
  <tbody>
    {% for v in variants %}
      <tr>
        <td>{{ v['name'] }}</td>
        <td>{{ currency_symbol }} {{ format_price((v['price_cents'] is not none) and v['price_cents'] or p['price_cents']) }}</td>
        <td>{% if v['track_inventory'] %}{{ v['stock_qty'] }}{% else %}â€”{% endif %}</td>
        <td>
          <form method="post" action="{{ url_for('admin_variant_delete', pid=p['id'], vid=v['id']) }}" style="display:inline;">
            {{ csrf_token()|safe }}
            <button class="btn btn-outline" type="submit" onclick="return confirm('Delete variant?')">Delete</button>
          </form>
        </td>
      </tr>
    {% else %}
      <tr><td colspan="4">No variants yet.</td></tr>
    {% endfor %}
  </tbody>
  
</table>
{% endif %}
{% endblock %}
